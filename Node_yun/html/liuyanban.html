<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>留言板</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
    <style>
        ul {
            list-style: none;
        }
        li {
            position: relative;
        }
        .comment-tt,
        .comment-bd,
        .comment-date {
            padding: 0 50px;
            margin-top: 10px;
            color: #333;
        }
        
        .comment-date {
            color: #999;
        }
        .delBtn{
            width: 30px;
            height: 30px;
            position: absolute;
            right: 50px;
            bottom: 0px;
            cursor: pointer;
        }
        .delBtn>span{
            width: 30px;
            height: 30px;
            font-size: 30px;
            line-height: 30px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>留言板</h2>
        <div>
            <input type="text" class="form-control title" placeholder="标题">
            <textarea class="form-control main" rows="3" placeholder="内容"></textarea>
            <div style="margin-top: 20px;" id="sex">
                性别：
                <label class="radio-inline">
                    <input type="radio" name="sex" id="inlineRadio1" value="1"> 男
                </label>
                <label class="radio-inline">
                    <input type="radio" name="sex" id="inlineRadio2" value="0"> 女
                </label>
            </div>
        </div>
        <div style="margin-top: 20px;text-align: center">
            <button type="submit" class="btn btn-primary submit">提交</button>
        </div>
    </div>
    <div class="container" style="margin-top: 50px;">
        <ul class="libox">
            
        </ul>
    </div>
</body>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
<script>
    $.ajax({
        url: "/api/getmsg",
        type: "GET",
        success: (data) => {
            console.log(data);
            var html = ''
            data.forEach((item, index) => {
                var date = formatTime(new Date(parseInt(item.date)));
                html +=
                    `<li>
                <div class="comment-tt">
                    ${item.title}
                </div>
                <div class="comment-bd">${item.main}</div>
                <div class="comment-date">${date}</div>
                <div class="delBtn" data-id='${item._id}'><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></div>
            </li>`
            })
            $('.libox').html(html);
            $('.delBtn').click(function() {
                var r = confirm('确定删除此留言么？');
                if(r){
                    delmag(this);
                }
            })
        }
    })
    $('.submit').click(() => {
        var data = {};
        data.title = $('.title').val();
        data.main = $('.main').val();
        data.sex = $('#sex input:radio:checked').val();
        data.date = (new Date()).getTime();
        $.ajax({
            url: "/api/addmsg",
            data: data,
            type: "POST",
            success: (data) => {
                console.log(data);
                window.location.reload()
            }
        })

    })

    const formatTime = date => {
        console.log(date);
        
        const year = date.getFullYear()
        const month = date.getMonth() + 1
        const day = date.getDate()
        const hour = date.getHours()
        const minute = date.getMinutes()
        const second = date.getSeconds()

        const formatNumber = n => {
            n = n.toString()
            return n[1] ? n : '0' + n
        }
        return [year, month, day].map(formatNumber).join('/') + ' ' + [hour, minute, second].map(formatNumber).join(':')
    }

    const delmag = that => {
        var data = {};
        data._id = $(that).attr('data-id');
        $.ajax({
            url: "/api/delmsg",
            data: data,
            type: "DELETE",
            success: (data) => {
                console.log(data);
                window.location.reload()
            }
        })
        
    }
</script>

</html>